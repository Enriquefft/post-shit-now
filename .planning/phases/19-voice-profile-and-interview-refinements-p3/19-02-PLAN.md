---
phase: 19-voice-profile-and-interview-refinements-p3
plan: 02
type: execute
wave: 1
depends_on: []
files_modified: [src/voice/import.ts]
autonomous: true
requirements: [m3]

must_haves:
  truths:
    - "Content import URLs are validated before processing"
    - "Invalid URLs return clear error messages without crashing"
    - "URL validation includes HTTP/HTTPS requirement and basic format checks"
  artifacts:
    - path: "src/voice/import.ts"
      provides: "URL validation function and importBlogContent integration"
      exports: ["validateUrl", "importBlogContent"]
      min_lines: 200
  key_links:
    - from: "src/voice/import.ts"
      to: "src/voice/import.ts"
      via: "validateUrl function called by importBlogContent"
      pattern: "validateUrl\\("
---

<objective>
Implement URL validation function and integrate it into the importBlogContent function.

Purpose: Prevent processing invalid URLs with clear error messages. Fail fast with actionable errors instead of attempting to fetch invalid URLs.
Output: URL validation function with integrated error handling for importBlogContent
</objective>

<execution_context>
@/home/hybridz/.claude/get-shit-done/workflows/execute-plan.md
@/home/hybridz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@src/voice/import.ts (importBlogContent, importXHistory, importRawText functions)
@src/core/utils/timezone.ts (isValidTimezone pattern for validation reference)
</context>

<tasks>

<task type="auto">
  <name>Add URL validation function to import.ts</name>
  <files>src/voice/import.ts</files>
  <action>
    Add validateUrl function to src/voice/import.ts:

    1. Accept string URL parameter
    2. Check for HTTP/HTTPS protocol required (no file://, javascript:, etc.)
    3. Validate basic URL format using URL constructor
    4. Return {valid: boolean, error: string | null} result

    Validation rules:
    - Must start with http:// or https://
    - Must have a valid hostname (no empty or whitespace)
    - Must not contain dangerous protocols (javascript:, data:, file:)
    - Must not be localhost/127.0.0.1 (security check for remote execution)

    Error messages should be actionable:
    - "Invalid URL protocol. URL must start with http:// or https://"
    - "Invalid URL format. Could not parse hostname."
    - "Localhost URLs are not allowed. Use a publicly accessible URL."

    Pattern from src/core/utils/timezone.ts isValidTimezone function:
    - Use try/catch with URL constructor for validation
    - Return boolean/null signature for easy consumption
  </action>
  <verify>grep -q "validateUrl" src/voice/import.ts</verify>
  <done>URL validation function added with HTTP/HTTPS requirement and format checks</done>
</task>

<task type="auto">
  <name>Integrate validation into importBlogContent</name>
  <files>src/voice/import.ts</files>
  <action>
    Update importBlogContent function to validate URLs before processing:

    1. Accept array of URL strings
    2. For each URL, call validateUrl() first
    3. If invalid, throw descriptive error with URL and validation reason
    4. Only proceed with fetching valid URLs

    Error format:
    "Invalid URL 'https://example.com/blog': Invalid URL format. Could not parse hostname."

    This prevents fetch attempts on invalid URLs and provides immediate feedback.
    Graceful degradation: continue processing other URLs if some are valid, unless all are invalid.

    Follow existing error pattern from src/voice/import.ts:
    - Throw Error with descriptive messages
    - Let caller handle catch/reporting
  </action>
  <verify>grep -A5 "export function importBlogContent" src/voice/import.ts | grep -q validateUrl</verify>
  <done>importBlogContent validates all URLs before attempting fetch operations</done>
</task>

</tasks>

<verification>
1. Create test file in src/voice/__tests__/import.test.ts or use temporary script
2. Test valid URL: validateUrl("https://example.com/blog") returns {valid: true, error: null}
3. Test invalid protocol: validateUrl("file:///path/to/file") returns {valid: false, error: "Invalid URL protocol..."}
4. Test malformed URL: validateUrl("not-a-url") returns {valid: false, error: "Invalid URL format..."}
5. Test localhost rejection: validateUrl("http://localhost/blog") returns {valid: false, error: "Localhost URLs are not allowed..."}
6. Test importBlogContent with mixed valid/invalid URLs
7. Verify error messages are clear and actionable
</verification>

<success_criteria>
- URL validation prevents invalid URLs from being processed
- Error messages include the problematic URL and specific validation failure reason
- importBlogContent validates all URLs before attempting fetch operations
- Invalid URLs throw descriptive errors with actionable messages
</success_criteria>

<output>
After completion, create `.planning/phases/19-voice-profile-and-interview-refinements-p3/19-02-SUMMARY.md`
</output>
