---
phase: 19-voice-profile-and-interview-refinements-p3
plan: 06
type: execute
wave: 2
depends_on: [19-04]
files_modified: [src/voice/interview.ts, .claude/commands/psn/voice.md]
autonomous: true
requirements: [m7]

must_haves:
  truths:
    - "Platform questions only appear for selected platforms"
    - "Platform persona answers are integrated into VoiceProfile"
    - "Users can configure unique voices per platform"
    - "Documentation explains platform persona interview flow"
  artifacts:
    - path: "src/voice/interview.ts"
      provides: "Platform persona filtering and integration"
      exports: ["generateQuestions", "finalizeProfile"]
    - path: ".claude/commands/psn/voice.md"
      provides: "Documentation for platform persona interview"
  key_links:
    - from: "src/voice/interview.ts"
      to: "src/voice/types.ts"
      via: "PlatformPersona type for validation"
      pattern: "platformPersonaSchema"
    - from: "src/voice/interview.ts"
      to: "src/voice/interview.ts"
      via: "generateQuestions filtering logic"
      pattern: "PLATFORM_QUESTIONS.filter"
    - from: ".claude/commands/psn/voice.md"
      to: "src/voice/interview.ts"
      via: "Documentation of platform persona interview"
      pattern: "platform personas"
---

<objective>
Implement platform question filtering logic, integrate platform persona answers into profile generation, and update documentation.

Purpose: Complete platform persona feature by filtering questions, building personas from interview answers, and documenting the flow.
Output: Filtered platform questions, platform personas in VoiceProfile, and updated documentation
</objective>

<execution_context>
@/home/hybridz/.claude/get-shit-done/workflows/execute-plan.md
@/home/hybridz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@src/voice/types.ts (PlatformPersona schema with tone, formatPreferences, hashtagStyle, emojiUsage)
@src/voice/interview.ts (generateQuestions function, finalizeProfile function, PLATFORM_QUESTIONS from plan 04)
@.claude/commands/psn/voice.md
@.planning/phases/08-instagram-tiktok-and-engagement/08-05-PLAN.md (platform-specific content guidance)
</context>

<tasks>

<task type="auto">
  <name>Update generateQuestions to filter platform questions</name>
  <files>src/voice/interview.ts</files>
  <action>
    Update generateQuestions function to show platform questions based on platform_select:

    1. Read platform_select answer from state.answers
    2. Parse selected platforms from multi-choice response
    3. Filter PLATFORM_QUESTIONS to only include questions for selected platforms
    4. Add filtered questions to returned question array

    Logic:
    ```typescript
    function generateQuestions(state: InterviewState): InterviewQuestion[] {
      // ... existing question generation ...

      // Platform questions
      const platformSelect = state.answers.get("platform_select");
      if (platformSelect) {
        const selectedPlatforms = parsePlatformSelection(platformSelect);
        const platformQuestions = PLATFORM_QUESTIONS.filter(q => {
          if (q.id === "platform_select") return true;
          // Check if question belongs to selected platform
          return selectedPlatforms.some(p => q.id.startsWith(`${p}_`));
        });
        questions.push(...platformQuestions);
      }

      return questions;
    }
    ```

    This ensures users only answer questions for platforms they selected.

    Follow existing branching pattern (maturity, experience level detection).
    Use platformSelect as filter condition for platform-specific questions.
  </action>
  <verify>grep -A20 "export function generateQuestions" src/voice/interview.ts | grep -q "PLATFORM_QUESTIONS"</verify>
  <done>generateQuestions filters platform questions based on user selection</done>
</task>

<task type="auto">
  <name>Update voice.md documentation</name>
  <files>.claude/commands/psn/voice.md</files>
  <action>
    Update /psn:voice edit section to document platform persona interview:

    Add under "3. Platform personas" section:
    "The interview now guides you through configuring platform-specific voices:
    - Platform selection: Choose which platforms to post on
    - For each platform: Configure tone, format preferences, hashtag style, emoji usage
    - Platform-specific guidance provided with examples
    - Skip platforms you don't use â€” can add later via edit"

    This explains the new platform persona interview flow to users.

    Also add to /psn:voice interview section:
    "Platform personas: After basic interview, you'll configure unique voices for each platform.
    This ensures content fits platform norms (hashtags, emojis, tone)."
  </action>
  <verify>grep -q "Platform personas" .claude/commands/psn/voice.md</verify>
  <done>Documentation updated to explain platform persona interview</done>
</task>

<task type="auto">
  <name>Update finalizeProfile to build platform personas from answers</name>
  <files>src/voice/interview.ts</files>
  <action>
    Update finalizeProfile function to build platform personas from interview answers:

    1. For each platform, build PlatformPersona object from answers
    2. Map platform select option to platform key (x, linkedin, instagram, tiktok)
    3. Extract tone, formatPreferences, hashtagStyle, emojiUsage from answers
    4. Use defaults if not provided

    Platform persona mapping:
    ```typescript
    const platforms: Record<string, PlatformPersona> = {};

    if (selectedPlatforms.includes("X (Twitter)")) {
      platforms.x = {
        tone: state.answers.get("x_tone") || "casual",
        formatPreferences: parseMultiChoice(state.answers.get("x_format")) || ["thread"],
        hashtagStyle: state.answers.get("x_hashtags") || "minimal",
        emojiUsage: state.answers.get("x_emoji") || "rare"
      };
    }
    // Similar for LinkedIn, Instagram, TikTok...
    ```

    Include platforms object in generated VoiceProfile.

    Follow existing answer parsing pattern (pillars from comma-separated string).
    Provide sensible defaults for missing answers.
  </action>
  <verify>grep -A10 "export function finalizeProfile" src/voice/interview.ts | grep -q "platforms"</verify>
  <done>Platform persona answers integrated into profile generation with defaults</done>
</task>

</tasks>

<verification>
1. Run interview: bun run src/cli/voice-interview.ts start
2. Select X platform only, verify only X-related questions appear
3. Complete interview with X platform, verify generated profile has platforms.x configured
4. Re-run with multiple platforms, verify all platform personas are in profile
5. Check documentation is clear about platform persona flow
</verification>

<success_criteria>
- Platform questions filter correctly based on platform_select answer
- Platform personas correctly integrated into VoiceProfile from interview answers
- Default values applied when answers are missing
- Documentation explains platform selection and configuration
- Documentation includes platform-specific examples
</success_criteria>

<output>
After completion, create `.planning/phases/19-voice-profile-and-interview-refinements-p3/19-06-SUMMARY.md`
</output>
