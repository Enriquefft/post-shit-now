---
phase: 19-voice-profile-and-interview-refinements-p3
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/voice/profile.ts, src/cli/voice-config.ts, .claude/commands/psn/voice.md]
autonomous: true
requirements: [m2]

must_haves:
  truths:
    - "Users can run /psn:voice validate to check voice profile schema compliance"
    - "Validation returns detailed error messages for any schema violations"
    - "All required fields are validated with clear feedback"
  artifacts:
    - path: "src/voice/profile.ts"
      provides: "Voice profile validation functions"
      exports: ["validateProfile"]
      min_lines: 100
    - path: "src/cli/voice-config.ts"
      provides: "CLI command for voice validation"
      exports: ["validate"]
  key_links:
    - from: "src/cli/voice-config.ts"
      to: "src/voice/profile.ts"
      via: "validateProfile function call"
      pattern: "validateProfile\\(profilePath\\)"
---

<objective>
Add voice profile validation command to allow users to verify their voice profile YAML files conform to the schema before attempting to use them.

Purpose: Early detection of profile corruption prevents runtime errors during content generation and setup.
Output: CLI command for validating voice profiles with detailed error reporting
</objective>

<execution_context>
@/home/hybridz/.claude/get-shit-done/workflows/execute-plan.md
@/home/hybridz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@src/voice/profile.ts (validateProfile function exists, returns {valid, errors})
@src/voice/types.ts (voiceProfileSchema for validation)
@.claude/commands/psn/voice.md
</context>

<tasks>

<task type="auto">
  <name>Add validate subcommand to voice-config.ts</name>
  <files>src/cli/voice-config.ts</files>
  <action>
    Add a new 'validate' subcommand to voice-config.ts CLI:

    1. Accept --profile-path flag (defaults to "content/voice/personal.yaml")
    2. Load profile using validateProfile() function from src/voice/profile.ts
    3. If valid: print success message with profile path
    4. If invalid: print detailed error messages with field paths and descriptions
    5. Exit with appropriate exit code (0 for valid, 1 for invalid)

    Follow existing pattern from src/cli/voice-config.ts for CLI structure:
    - Use import.meta.main for direct execution
    - Parse command line arguments
    - Output structured results for Claude integration

    Error format should be user-friendly:
    "Invalid voice profile at content/voice/personal.yaml:
     - identity.pillars: Expected array, got string
     - style.formality: Expected number 1-10, got 15"
  </action>
  <verify>bun run src/cli/voice-config.ts validate</verify>
  <done>CLI command validates profiles and returns detailed error messages for any schema violations</done>
</task>

<task type="auto">
  <name>Update voice.md slash command documentation</name>
  <files>.claude/commands/psn/voice.md</files>
  <action>
    Add new subcommand documentation to .claude/commands/psn/voice.md:

    ### /psn:voice validate â€” Validate voice profile

    Validates voice profile YAML files against the schema to detect corruption or manual editing errors.

    Usage:
    ```
    /psn:voice validate [--profile-path path/to/profile.yaml]
    ```

    If no --profile-path provided, validates content/voice/personal.yaml

    Output:
    - **Valid:** Profile conforms to schema
    - **Invalid:** Lists all validation errors with field paths and descriptions

    Use after manually editing profile files or importing from external sources.
  </action>
  <verify>grep -q "/psn:voice validate" .claude/commands/psn/voice.md</verify>
  <done>Voice validate subcommand documented in slash command reference</done>
</task>

</tasks>

<verification>
1. Run validation on a valid profile: bun run src/cli/voice-config.ts validate --profile-path content/voice/personal.yaml
2. Create a corrupted YAML and run validation: bun run src/cli/voice-config.ts validate --profile-path /tmp/corrupted.yaml
3. Verify error messages include field paths and clear descriptions
4. Confirm exit codes are correct (0 for valid, non-zero for invalid)
</verification>

<success_criteria>
- /psn:voice validate command works for both valid and invalid profiles
- Error messages include field paths and descriptions for easy debugging
- Command returns appropriate exit codes for automation
- Documentation updated in voice.md
</success_criteria>

<output>
After completion, create `.planning/phases/19-voice-profile-and-interview-refinements-p3/19-01-SUMMARY.md`
</output>
