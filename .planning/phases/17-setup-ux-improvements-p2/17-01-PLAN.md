---
phase: 17-setup-ux-improvements-p2
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [package.json, src/cli/utils/progress.ts, src/cli/setup-db.ts, src/cli/setup-trigger.ts]
autonomous: true
requirements: [m1]

must_haves:
  truths:
    - "Long-running operations show step-by-step progress with timing"
    - "Full step list displayed from start (not sequential reveal)"
    - "Spinner shows running state and updates to success/failure with duration"
    - "Progress works in both TTY and non-TTY environments"
  artifacts:
    - path: "src/cli/utils/progress.ts"
      provides: "Progress indicator utilities with ora wrapper"
      exports: ["StepProgress", "createProgressStep", "runStep"]
    - path: "package.json"
      provides: "ora dependency for spinners"
      contains: '"ora"'
  key_links:
    - from: "src/cli/setup-db.ts"
      to: "src/cli/utils/progress.ts"
      via: "import runStep"
      pattern: "import.*runStep.*progress"
    - from: "src/cli/setup-trigger.ts"
      to: "src/cli/utils/progress.ts"
      via: "import runStep"
      pattern: "import.*runStep.*progress"
---

<objective>
Add step-by-step progress indicators to long-running setup operations using ora spinners with timing information.

Purpose: Improve user visibility into setup progress by showing all steps upfront, updating status in real-time with spinners, and displaying duration for each completed step.

Output: Progress indicator utilities (src/cli/utils/progress.ts) applied to database and Trigger.dev setup operations.
</objective>

<execution_context>
@/home/hybridz/.claude/get-shit-done/workflows/execute-plan.md
@/home/hybridz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-setup-ux-improvements-p2/17-CONTEXT.md
@.planning/phases/17-setup-ux-improvements-p2/17-RESEARCH.md

@src/cli/setup-db.ts
@src/cli/setup-trigger.ts
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add ora dependency and create progress utilities</name>
  <files>package.json, src/cli/utils/progress.ts</files>
  <action>
1. Add ora to package.json:
   - Run: bun add ora
   - Verify ora appears in dependencies

2. Create src/cli/utils/progress.ts with:
   - StepProgress interface (name, status, duration)
   - createProgressStep(steps: string[]) function to display full step list upfront
   - runStep<T>(stepName: string, fn: () => Promise<T>) function for step execution with ora spinner and timing

3. Per user constraint from 17-CONTEXT.md:
   - Display all steps from the start (not sequential reveal)
   - Show running indicator with timing: `⠋ Database connecting...` → `✓ Database connecting [1.2s]`
   - Apply to long-running operations specifically (database, migrations, API calls)

4. Ora handles TTY detection automatically - no special handling needed per 17-RESEARCH.md Pattern 1.

Reference: 17-RESEARCH.md Pattern 1 code example for exact implementation.
  </action>
  <verify>
1. grep '"ora"' package.json confirms dependency added
2. ls src/cli/utils/progress.ts confirms file exists
3. grep "StepProgress\|createProgressStep\|runStep" src/cli/utils/progress.ts confirms exports
  </verify>
  <done>
ora dependency installed, progress.ts file created with StepProgress interface, createProgressStep function, and runStep function with ora spinner wrapper.
  </done>
</task>

<task type="auto">
  <name>Task 2: Apply progress indicators to database setup</name>
  <files>src/cli/setup-db.ts</files>
  <action>
1. Import runStep from progress.ts at top of file
2. Wrap long-running operations in setupDatabase function with runStep calls:
   - Create Neon project: runStep("Creating Neon project", () => Bun.spawn...)
   - Run migrations: runStep("Running database migrations", () => runMigrationsWithRetry(...))
3. Display full step list at start using createProgressStep with:
   - Creating Neon project
   - Running database migrations
   - Saving connection to .hubs/personal.json

Per user constraint: Apply to long-running operations specifically. The database creation and migration steps qualify (can take 5-30s each). Skip quick operations like file writes and env checks.

Keep existing error handling - runStep's catch will propagate errors properly.
  </action>
  <verify>
1. grep "import.*runStep.*progress" src/cli/setup-db.ts confirms import
2. grep "runStep.*Creating Neon project" src/cli/setup-db.ts confirms first step wrapped
3. grep "runStep.*Running database migrations" src/cli/setup-db.ts confirms second step wrapped
  </verify>
  <done>
Database setup operations show progress indicators for Neon project creation and migrations with timing information.
  </done>
</task>

<task type="auto">
  <name>Task 3: Apply progress indicators to Trigger.dev setup</name>
  <files>src/cli/setup-trigger.ts</files>
  <action>
1. Import runStep from progress.ts at top of file
2. Wrap long-running operations in setupTrigger function with runStep calls:
   - Running trigger.dev init: runStep("Initializing Trigger.dev project", () => Bun.spawn([...bunx, "trigger.dev@latest", "init"...]))
3. Display full step list at start using createProgressStep with:
   - Detecting project ref
   - Initializing Trigger.dev project (if needed)
   - Updating trigger.config.ts

Per user constraint: Apply to long-running operations specifically. The trigger.dev init call qualifies (can take 10-30s). Skip quick operations like file reads and string replacements.

Keep existing error handling - runStep's catch will propagate errors properly.
  </action>
  <verify>
1. grep "import.*runStep.*progress" src/cli/setup-trigger.ts confirms import
2. grep "runStep.*Initializing Trigger.dev" src/cli/setup-trigger.ts confirms step wrapped
3. grep "createProgressStep" src/cli/setup-trigger.ts confirms step list displayed
  </verify>
  <done>
Trigger.dev setup operations show progress indicators for project initialization with timing information.
  </done>
</task>

</tasks>

<verification>
Run setup with long-running operations to verify:
- Full step list displayed before any work starts
- Spinner shows running state during operations
- Success/failure messages include duration in seconds
- Output works in both TTY terminal and piped environments
</verification>

<success_criteria>
- ora dependency installed in package.json
- src/cli/utils/progress.ts created with exports
- Database setup shows progress for Neon project creation and migrations
- Trigger.dev setup shows progress for init operation
- Each step displays duration on completion
</success_criteria>

<output>
After completion, create `.planning/phases/17-setup-ux-improvements-p2/17-01-SUMMARY.md`
</output>
