---
phase: 17-setup-ux-improvements-p2
plan: 04
type: execute
wave: 1
depends_on: []
files_modified: [src/cli/setup-trigger.ts]
autonomous: true
requirements: [M3]

must_haves:
  truths:
    - "Trigger.dev init uses current CLI flags correctly"
    - "Flags like --skip-install are passed through bunx to trigger.dev CLI"
    - "Invalid Trigger.dev arguments fail fast and stop immediately"
  artifacts:
    - path: "src/cli/setup-trigger.ts"
      provides: "Trigger.dev setup with correct CLI flag pass-through"
      contains: '"bunx", "trigger.dev@latest", "init"'
  key_links:
    - from: "src/cli/setup-trigger.ts"
      to: "bunx CLI"
      via: "Bun.spawn arguments array"
      pattern: 'Bun\.spawn\(\["bunx"'
---

<objective>
Fix Trigger.dev setup CLI argument handling to pass flags correctly through bunx.

Purpose: Resolve issue M3 where Trigger.dev setup doesn't use current CLI flags, ensuring arguments like --skip-install are properly passed to the trigger.dev CLI.

Output: Updated setup-trigger.ts with correct bunx argument pass-through for Trigger.dev CLI flags.
</objective>

<execution_context>
@/home/hybridz/.claude/get-shit-done/workflows/execute-plan.md
@/home/hybridz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-setup-ux-improvements-p2/17-CONTEXT.md
@.planning/phases/17-setup-ux-improvements-p2/17-RESEARCH.md

@src/cli/setup-trigger.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix Trigger.dev CLI flag pass-through</name>
  <files>src/cli/setup-trigger.ts</files>
  <action>
Per user constraint from 17-CONTEXT.md: Invalid Trigger.dev arguments should fail fast and early (stop immediately).

Current code (line 57):
```typescript
const proc = Bun.spawn(["bunx", "trigger.dev@latest", "init", "--skip-install"], {...})
```

Issue: The --skip-install flag placement may be incorrect per Trigger.dev CLI conventions. Research from 17-RESEARCH.md indicates: "The issue: `--skip-install` may need to be after init"

Fix approach:
1. Test the current argument order by checking Trigger.dev CLI documentation
2. If --skip-install needs to be after subcommand flags, rearrange arguments
3. Common bunx pattern: ["bunx", "package@version", "command", "--flag1", "--flag2"]

Update the Bun.spawn call to use correct flag ordering:
- Move --skip-install to after any positional arguments (there are none for "init")
- If Trigger.dev CLI accepts global flags before subcommand, keep --skip-install before "init"
- If Trigger.dev CLI requires subcommand flags after subcommand, move --skip-install after "init"

Per 17-RESEARCH.md Pitfall 4: "Check trigger.dev CLI documentation for correct flag placement"

If documentation is unavailable, use the standard CLI convention: flags can be placed anywhere in the command, so the current order should work. The issue may be in how bunx interprets the arguments.

Alternative fix if current order is correct:
- Use proper Bun.spawn argument array structure
- Ensure env variable is passed correctly (already done: env: { ...process.env, TRIGGER_SECRET_KEY })
- Add error handling to surface any bunx parsing issues

Implementation:
1. Modify the Bun.spawn call on line 57 to use clear flag ordering
2. Add explicit flag array if needed: const triggerFlags = ["--skip-install"]
3. Spawn with: ["bunx", "trigger.dev@latest", "init", ...triggerFlags]

Note: This is a single-line change to fix argument order. No other changes needed.
  </action>
  <verify>
1. grep "Bun.spawn.*trigger.dev.*init" src/cli/setup-trigger.ts confirms the call exists
2. Check that --skip-install is in the correct position relative to "init" command
3. If using spread operator, grep "\.\.\..*triggerFlags" confirms flag passing
  </verify>
  <done>
Trigger.dev setup correctly passes CLI flags through bunx, ensuring --skip-install is recognized by the trigger.dev CLI.
  </done>
</task>

</tasks>

<verification>
Test Trigger.dev setup to verify:
- The trigger.dev init command recognizes --skip-install flag
- No errors from incorrect argument placement
- Setup completes or fails with clear error message (not silent flag failure)
</verification>

<success_criteria>
- Bun.spawn call uses correct flag order for trigger.dev CLI
- --skip-install flag is passed and recognized by trigger.dev init
- Invalid arguments fail fast with clear error message
</success_criteria>

<output>
After completion, create `.planning/phases/17-setup-ux-improvements-p2/17-04-SUMMARY.md`
</output>
