---
phase: 17-setup-ux-improvements-p2
plan: 05
type: execute
wave: 1
depends_on: []
files_modified: [src/cli/setup-db.ts]
autonomous: true
requirements: [M13]

must_haves:
  truths:
    - "Missing neonctl shows actionable error with installation commands"
    - "Error includes documentation link for neonctl"
    - "User knows how to install neonctl without manual PATH changes"
  artifacts:
    - path: "src/cli/setup-db.ts"
      provides: "Enhanced neonctl error with actionable guidance"
      contains: '"neonctl CLI not found"'
  key_links:
    - from: "src/cli/setup-db.ts"
      to: "neonctl CLI error handling"
      via: "try/catch around Bun.which('neonctl')"
      pattern: 'neonctl.*not found'
---

<objective>
Resolve neonctl PATH issue by providing actionable error messages with installation commands and documentation.

Purpose: Improve error handling when neonctl is not found in PATH, giving users clear next steps instead of a generic error message.

Output: Enhanced neonctl error handling in setup-db.ts with installation instructions and documentation links.
</objective>

<execution_context>
@/home/hybridz/.claude/get-shit-done/workflows/execute-plan.md
@/home/hybridz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-setup-ux-improvements-p2/17-CONTEXT.md
@.planning/phases/17-setup-ux-improvements-p2/17-RESEARCH.md

@src/cli/setup-db.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Improve neonctl PATH error with actionable guidance</name>
  <files>src/cli/setup-db.ts</files>
  <action>
Per user constraint from 17-CONTEXT.md: Missing neonctl should show actionable suggestion with documentation link.

Current code (lines 84-95):
```typescript
try {
  const which = Bun.spawn(["which", "neonctl"], { stdout: "pipe", stderr: "pipe" });
  await which.exited;
  if (which.exitCode !== 0) {
    throw new Error("not found");
  }
} catch {
  return {
    step: "database",
    status: "error",
    message: "neonctl CLI not found. Install it: npm i -g neonctl (or bun add -g neonctl)",
  };
}
```

This is already good but can be enhanced with more detailed guidance per 17-RESEARCH.md Pattern "Neonctl PATH Error Improvement".

Update the error return to include structured data with installation commands, documentation link, and troubleshooting steps:

```typescript
return {
  step: "database",
  status: "error",
  message: "neonctl CLI not found in PATH",
  data: {
    suggestion: "Install neonctl to continue with database setup:",
    commands: [
      "npm install -g neonctl",
      "bun add -g neonctl",
    ],
    docs: "https://neon.tech/docs/reference/cli-reference",
    troubleshooting: [
      "After installation, restart your terminal or run: source ~/.bashrc (or ~/.zshrc)",
      "Verify installation with: neonctl version",
    ],
  },
};
```

This matches the 17-RESEARCH.md Pattern example while keeping the simple message for human readability.

No changes needed to the try/catch structure - just enhance the return object with detailed data.
  </action>
  <verify>
1. grep '"neonctl CLI not found in PATH"' src/cli/setup-db.ts confirms updated message
2. grep "docs.*neon.tech" src/cli/setup-db.ts confirms documentation link
3. grep "commands.*npm install -g neonctl" src/cli/setup-db.ts confirms installation commands
4. grep "troubleshooting" src/cli/setup-db.ts confirms troubleshooting steps
  </verify>
  <done>
Neonctl error message enhanced with actionable installation commands, documentation link, and troubleshooting steps.
  </done>
</task>

</tasks>

<verification>
Test neonctl error handling by:
1. Temporarily removing neonctl from PATH or renaming it
2. Running setup database
3. Verifying error message includes:
   - Clear statement that neonctl is not found
   - Installation commands (npm and bun)
   - Documentation link to neon.tech
   - Troubleshooting tips for PATH issues
</verification>

<success_criteria>
- Error message states "neonctl CLI not found in PATH"
- data.commands includes both npm and bun installation commands
- data.docs points to neon.tech CLI documentation
- data.troubleshooting provides PATH verification steps
- User can follow guidance to resolve the issue independently
</success_criteria>

<output>
After completion, create `.planning/phases/17-setup-ux-improvements-p2/17-05-SUMMARY.md`
</output>
