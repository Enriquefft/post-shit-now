---
phase: 18-provider-key-and-entity-config-p2
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/entity-creation-workflow.md
autonomous: true
requirements:
  - m4
must_haves:
  truths:
    - "Entity slug collision handling is verified and documented"
    - "ensureUniqueSlug() function works correctly for duplicate names"
    - "Users understand how slug collisions are handled automatically"
  artifacts:
    - path: "src/voice/entity-profiles.ts"
      provides: "Entity slug collision resolution"
      contains: "ensureUniqueSlug"
    - path: "docs/entity-creation-workflow.md"
      provides: "Slug collision handling documentation"
      contains: "Slug Collisions"
  key_links:
    - from: "src/voice/entity-profiles.ts"
      to: "src/core/db/schema.ts"
      via: "voice_profiles table query"
      pattern: "ensureUniqueSlug.*select.*entitySlug"
---

<objective>
Verify that entity slug collision handling works correctly and document the behavior for users.

Purpose: Issue m4 - Entity slug collision handling. The `ensureUniqueSlug()` function already implements slug collision resolution by appending -2, -3, etc. to duplicate names. This plan verifies the implementation works correctly and documents the behavior.

Output: Verified slug collision handling and documented behavior in the workflow guide.
</objective>

<execution_context>
@/home/hybridz/.claude/get-shit-done/workflows/execute-plan.md
@/home/hybridz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-provider-key-and-entity-config-p2/18-RESEARCH.md

@src/voice/entity-profiles.ts (lines 228-248 - ensureUniqueSlug function)
@src/voice/entity-profiles.ts (lines 115-135 - createEntity function)
</context>

<tasks>

<task type="auto">
  <name>Verify and document entity slug collision handling</name>
  <files>docs/entity-creation-workflow.md</files>
  <action>
    1. First, verify the existing `ensureUniqueSlug()` implementation in src/voice/entity-profiles.ts (lines 228-248):

    - Confirm it queries all existing slugs for the user
    - Confirm it checks for base slug collision
    - Confirm it appends -2, -3, etc. incrementally until finding an available slug
    - Confirm it's used by `createEntity()` function

    The function should already implement this correctly per Phase 12 research.

    2. Then, update the "Slug Collisions" section in docs/entity-creation-workflow.md to reflect the verified behavior:

    Update the section to include:
    - Automatic slug generation from display name
    - Collision detection checks all existing slugs for the user
    - Incremental suffix pattern (-2, -3, -N) for duplicates
    - Example: "My Project" → "my-project", then "my-project-2", then "my-project-3"
    - Note that this is automatic—users don't need to manually avoid conflicts

    The documentation from plan 18-03 should already include this section, so this is verification and refinement.

    3. Optionally, add a note about case sensitivity (if relevant):
    - Slugs are typically lowercase with hyphens
    - Original case is preserved in displayName, only slug is normalized

    No code changes are required—the existing implementation already handles this correctly. This is a verification and documentation task.
  </action>
  <verify>
    1. Read src/voice/entity-profiles.ts and confirm ensureUniqueSlug() implementation is correct
    2. Read docs/entity-creation-workflow.md and confirm Slug Collisions section accurately describes the behavior
    3. Verify createEntity() calls ensureUniqueSlug()
  </verify>
  <done>
    Entity slug collision handling is verified to work correctly and documented for users.
  </done>
</task>

</tasks>

<verification>
Overall phase verification:
1. ensureUniqueSlug() function correctly queries existing slugs
2. Function appends -2, -3, etc. for collisions
3. createEntity() uses ensureUniqueSlug() to generate unique slugs
4. Documentation accurately describes the automatic collision handling
5. No code changes required (implementation already correct)
</verification>

<success_criteria>
Entity slug collision handling is verified and documented. Users understand that slug conflicts are resolved automatically.
</success_criteria>

<output>
After completion, create `.planning/phases/18-provider-key-and-entity-config-p2/18-04-SUMMARY.md`
</output>
