---
phase: 08-instagram-tiktok-and-engagement
plan: 06
type: gap_closure
wave: 1
depends_on: ["08-05"]
files_modified:
  - .planning/REQUIREMENTS.md
  - src/engagement/tracker.ts
autonomous: true
requirements: [ENGAGE-01]

must_haves:
  truths:
    - "ENGAGE-01 requirement text aligned with locked decision (2-4 hour cadence, not 5-15 min)"
    - "Engagement tracker wires into Phase 4 learning loop via src/learning/feedback.ts"
  artifacts:
    - path: ".planning/REQUIREMENTS.md"
      provides: "ENGAGE-01 text updated to reflect accepted 2-4 hour cadence"
    - path: "src/engagement/tracker.ts"
      provides: "Feedback loop wire from engagement outcomes to preference model"
      exports: ["trackEngagementOutcome", "updateScoringWeights", "feedEngagementToLearningLoop", "getEngagementStats", "getEngagementHistory"]
  key_links:
    - from: "src/engagement/tracker.ts"
      to: "src/learning/feedback.ts"
      via: "engagement outcome signals fed into feedback detection"
      pattern: "detectFeedbackMoments"
---

<objective>
Close 2 verification gaps from Phase 8:
1. ENGAGE-01 frequency text in REQUIREMENTS.md says "every 5-15 min" but locked decision is "every 2-4 hours" (implemented as every 3 hours). Align the requirement text.
2. src/engagement/tracker.ts has no import from src/learning/feedback.ts — engagement outcomes don't reach the Phase 4 learning loop. Wire it.
</objective>

<tasks>

<task type="auto">
  <name>Task 1: Align ENGAGE-01 requirement text</name>
  <files>
    .planning/REQUIREMENTS.md
  </files>
  <action>
    Update ENGAGE-01 text from "every 5-15 min during active hours" to "every 2-4 hours" to match the locked decision from 08-CONTEXT.md. The 5-15 min frequency was superseded by the user's explicit decision during phase discussion.
  </action>
  <verify>
    `grep "ENGAGE-01" .planning/REQUIREMENTS.md` shows updated frequency text.
  </verify>
  <done>
    ENGAGE-01 requirement text aligned with locked decision. No code change needed — implementation already correct at every 3 hours.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire engagement tracker to Phase 4 learning loop</name>
  <files>
    src/engagement/tracker.ts
  </files>
  <action>
    Add `feedEngagementToLearningLoop(db, userId)` function that:
    1. Import `detectFeedbackMoments` from `src/learning/feedback.ts`
    2. After engagement outcomes accumulate, call detectFeedbackMoments to check if engagement patterns warrant feedback
    3. Call this from `trackEngagementOutcome` after recording the outcome, so engagement signals flow into the broader learning system

    This completes the cross-phase wire: engagement outcomes → tracker → learning/feedback → preference model.
  </action>
  <verify>
    `npx tsc --noEmit` passes. `grep "learning/feedback" src/engagement/tracker.ts` shows import. `grep "feedEngagementToLearningLoop" src/engagement/tracker.ts` shows new function.
  </verify>
  <done>
    Engagement tracker wired to Phase 4 learning loop. Outcomes now flow through detectFeedbackMoments for pattern detection.
  </done>
</task>

</tasks>

<verification>
1. `grep "ENGAGE-01" .planning/REQUIREMENTS.md` — shows "2-4 hours" not "5-15 min"
2. `grep "learning/feedback" src/engagement/tracker.ts` — import present
3. `npx tsc --noEmit` — compiles clean
</verification>

<success_criteria>
- ENGAGE-01 requirement text matches locked decision (2-4 hours)
- Engagement tracker imports from and calls into src/learning/feedback.ts
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, update `.planning/phases/08-instagram-tiktok-and-engagement/08-VERIFICATION.md` gaps to resolved.
</output>
