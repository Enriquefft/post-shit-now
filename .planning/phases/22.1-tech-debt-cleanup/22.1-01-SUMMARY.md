---
phase: 22.1-tech-debt-cleanup
plan: 01
subsystem: api
tags: [typescript, drizzle, types, biome]

# Dependency graph
requires:
  - phase: 21-foundation-and-architecture-cleanup
    provides: "publisher.ts with DbConnection and PostRow canonical type aliases; publish-helpers.ts orchestration file"
  - phase: 22-documentation-and-module-boundaries
    provides: "CLAUDE.md module map; confirmation that no bare @psn/trigger alias exists"
provides:
  - "publish-helpers.ts imports DbConnection and PostRow from canonical source (@psn/core/types/publisher.ts)"
  - "PostSubStatus union type includes partial_failure member matching what publish-post.ts writes to DB"
  - "CLAUDE.md Module Map accurately documents @psn/trigger/* wildcard alias"
affects: [23-testing-infrastructure, publish-post, type-checking]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "Single-source-of-truth for type aliases: always import from @psn/core/types/publisher.ts, never re-declare locally"

key-files:
  created: []
  modified:
    - src/trigger/publish-helpers.ts
    - src/core/types/index.ts
    - CLAUDE.md

key-decisions:
  - "Biome import order and formatter issues auto-fixed (Rule 2) — these were direct consequences of inserting the new canonical import into an existing file"
  - "No bare @psn/trigger alias — correct form is @psn/trigger/* (wildcard) per tsconfig.json; src/trigger/index.ts barrel does not exist"

patterns-established:
  - "Canonical type import pattern: import type { DbConnection, PostRow } from '@psn/core/types/publisher.ts'"

requirements-completed: [ARCH-01, ARCH-04, DOC-01, ARCH-07]

# Metrics
duration: 5min
completed: 2026-02-27
---

# Phase 22.1 Plan 01: Tech Debt Cleanup Summary

**Closed three v1.2 audit gaps: canonical type imports in publish-helpers.ts, partial_failure added to PostSubStatus union, and corrected @psn/trigger/* alias in CLAUDE.md**

## Performance

- **Duration:** ~5 min
- **Started:** 2026-02-27T10:54:04Z
- **Completed:** 2026-02-27T10:59:00Z
- **Tasks:** 2
- **Files modified:** 3

## Accomplishments
- Eliminated local type re-declarations in publish-helpers.ts — DbConnection and PostRow now imported from canonical source (@psn/core/types/publisher.ts), enforcing single-source-of-truth (ARCH-01/ARCH-04)
- Added "partial_failure" to PostSubStatus union — publish-post.ts already writes this value to the DB; the union now matches the runtime behavior
- Corrected CLAUDE.md Module Map to show @psn/trigger/* instead of bare @psn/trigger, reflecting the actual tsconfig.json wildcard alias (DOC-01/ARCH-07)

## Task Commits

Each task was committed atomically:

1. **Task 1: Fix type imports in publish-helpers.ts and add partial_failure to PostSubStatus** - `6106691` (fix)
2. **Task 2: Correct @psn/trigger alias label in CLAUDE.md Module Map** - `7c8278a` (docs)

## Files Created/Modified
- `src/trigger/publish-helpers.ts` - Removed local DbConnection/PostRow type re-declarations; replaced with canonical import from @psn/core/types/publisher.ts; fixed biome import order and formatter issues
- `src/core/types/index.ts` - Added "partial_failure" to PostSubStatus union before null
- `CLAUDE.md` - Changed @psn/trigger to @psn/trigger/* in Module Map table

## Decisions Made
- Biome auto-flagged import ordering and a long logger.info line in publish-helpers.ts after inserting the new import — applied safe biome fixes inline (import order reorg and multi-line logger call) as these were direct consequences of the task edit, not pre-existing issues

## Deviations from Plan

### Auto-fixed Issues

**1. [Rule 2 - Missing Critical] Fixed biome import order and formatter issue in publish-helpers.ts**
- **Found during:** Task 1 (Fix type imports)
- **Issue:** Adding the @psn/core import triggered biome's import-order and formatter rules — the new import needed to be placed before @trigger.dev/sdk and a long logger.info call needed multi-line formatting
- **Fix:** Reordered imports alphabetically (type imports first per biome config); expanded logger.info call to multi-line format on line 106
- **Files modified:** src/trigger/publish-helpers.ts
- **Verification:** `bun run biome check src/trigger/publish-helpers.ts src/core/types/index.ts` — no errors
- **Committed in:** 6106691 (Task 1 commit)

---

**Total deviations:** 1 auto-fixed (Rule 2 — biome formatting/import ordering, direct consequence of canonical import insertion)
**Impact on plan:** Necessary for lint-clean state. No scope creep.

## Issues Encountered
None — all verification checks passed on first run after biome fixes.

## Next Phase Readiness
- All four phase 22.1 requirement IDs closed: ARCH-01, ARCH-04, DOC-01, ARCH-07
- v1.2 foundation is now clean: single source of truth for types enforced, PostSubStatus union matches runtime writes, module alias docs accurate
- Ready for Phase 23 (Testing Infrastructure)

## Self-Check: PASSED

- FOUND: src/trigger/publish-helpers.ts
- FOUND: src/core/types/index.ts
- FOUND: CLAUDE.md
- FOUND commit 6106691 (fix type imports, partial_failure)
- FOUND commit 7c8278a (CLAUDE.md alias fix)

---
*Phase: 22.1-tech-debt-cleanup*
*Completed: 2026-02-27*
